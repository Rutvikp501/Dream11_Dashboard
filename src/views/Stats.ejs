<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Performance Chart</title>
    <!-- Include ApexCharts library -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>
    <!-- //<%- include('./partials/navbar.ejs') %> -->
    <h1>Player Performance Chart</h1>
    <!-- Container for the chart -->
    <div id="chart"></div>

    <!-- Embedding the MatchDetails data into the HTML -->
    <script>
        // Get MatchDetails data from server-side rendering
        const MatchDetails = <%- JSON.stringify(MatchDetails) %>;

        // Function to generate chart data
        function generateChartData() {
            const chartData = {};
            MatchDetails.forEach(match => {
                if (match.players) {
                    match.players.forEach(player => {
                        if (!chartData[player.name]) {
                            chartData[player.name] = [];
                        }
                        const lastTotal = chartData[player.name].length > 0 ? chartData[player.name][chartData[player.name].length - 1].y : 0;
                        chartData[player.name].push({
                            x: match.match, // Match name as x-axis
                            y: lastTotal + player.points || 0 // Cumulative points earned in the match as y-axis
                        });
                    });
                }
            });
            return Object.entries(chartData).map(([player, data]) => ({
                name: player,
                data: data
            }));
        }

        // Define chart options
        const options = {
            series: generateChartData(),
            chart: {
                type: 'line',
                height: 350,
                stacked: false,
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [1, 1, 1, 1]
            },
            title: {
                text: 'Player Performance Chart',
                align: 'left',
                offsetX: 110
            },
            xaxis: {
                type: 'category',
                title: {
                    text: 'Match Name',
                },
            },
            yaxis: {
                title: {
                    text: 'Points Earned',
                },
            },
            tooltip: {
                shared: true,
                intersect: false,
                y: {
                    formatter: function (y) {
                        if (typeof y !== 'undefined') {
                            return y.toFixed(0) + ' points';
                        }
                        return y;
                    }
                }
            },
            markers: {
                size: 4 // Size of the data points
            }
        };

        // Render the chart
        const chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
    </script>
</body>
</html>
